<div class="app">

  <!-- header section -->
  <header>
    <h1>Note Taken</h1>
    <h2>Your little local notes app</h2>
  </header>

  <!-- navigation bar -->
  <nav>

    <!-- mobile only links -->
    <button *ngIf="(view !== 'info') && (view !== 'notebook')" class="nav-link" (click)="toggleView('notebook')" [disabled]="disableButton('notebook')">
      <p>Notes ({{allNotes.length}})</p>
    </button>
    <button *ngIf="view === 'notebook'" class="nav-link" (click)="toggleView('notepad')">
      <p>Add note</p>
    </button>
    <button *ngIf="view !== 'info'" class="nav-link info" (click)="toggleView('info')">
      <p>About the app</p>
    </button>

    <!-- desktop/mobile link -->
    <button *ngIf="view === 'info'" class="nav-link info back" (click)="toggleView('notepad')">
      <p>Back to the app</p>
    </button>
  </nav>

  <!-- main section -->
  <main>

    <!-- notepad section -->
    <div class="notepad" class="{{notepadColor}} {{view === 'notebook' || view === 'info' ? 'disabled' : ''}}">

      <!-- notepad colour options -->
      <div class="notepad-colours">
        <button *ngFor="let color of allColors; index as i" class="color-button {{color}}" (click)="updateNotepadColor(i)" [disabled]="notepadColor === allColors[i]">
        </button>
      </div>

      <!-- notepad text area -->
      <textarea [(ngModel)]="inputtedText" (ngModelChange)="formatInput()" maxlength="140" wrap="hard" placeholder={{placeholder}} (keydown.enter)="saveNote($event)"></textarea>

      <!-- notepad save and clear buttons -->
      <div class="notepad-buttons">
        <button (click)="saveNote($event)" [disabled]="!inputtedText">Save note</button>
        <button (click)="clearText()" [disabled]="!inputtedText">Clear text</button>
      </div>

    </div>

    <!-- notebook section -->
    <div class="notebook {{view === 'info' ? 'disabled' : ''}} {{view === 'notepad' || view === 'info' ? 'disabled-2' : ''}}  {{notebookOptions ? 'options-active' : ''}}">

      <!-- notebook sort and filter options -->
      <div *ngIf="allNotes.length > 2" class="notebook-filter-sort {{notebookOptions ? 'active' : ''}}">

        <!-- sort by oldest or newest -->
        <div class="sort-options">
          <p>Sort:</p>
          <div class="sort-buttons">
            <button class="sorting" (click)="reverseNoteOrder('newest')" [disabled]="disableButton('sorting-newest')">newest first</button>
            <button class="sorting" (click)="reverseNoteOrder('oldest')" [disabled]="disableButton('sorting-oldest')">oldest first</button>
          </div>
        </div>

        <!-- filter by colour -->
        <div class="filter-options">
          <p>Filter:</p>
          <div class="filter-buttons">
            <button *ngFor="let color of notebookColors.reverse(); index as i" class="color-button {{color}}" (click)="this.filter = color" (click)="filterNotesByColor()" [disabled]="filter === color">
            </button>
            <button class="all-filter" (click)="this.filter = 'all'" (click)="filterNotesByColor()" [disabled]="filter === 'all'">All</button>
          </div>
        </div>

      </div>

      <!-- search through the notes -->
      <div class="notebook-search {{allNotes.length < 3 ? 'disabled' : ''}}">

        <p>Search:</p>
        <input type="text" [(ngModel)]="searchQuery" (ngModelChange)="searchNotes()" placeholder="Start typing here to see results" class="{{searchQuery ? 'active' : ''}}"/>
        <button class="clear-search" (click)="clearSearch()" [disabled]="!searchQuery">
          Clear
        </button>

      </div>

      <!-- notebook list -->
      <ul class="notes-list">

        <!-- note item -->
        <li *ngFor="let note of filteredNotes.slice().reverse(); index as i" class="{{note.color}} {{view === 'notebook' ? 'active' : ''}}">
          <button class="edit" (click)="editNote(i)">Edit</button>
          <button class="delete" (click)="deleteNote(i)">Delete</button>
          <p class="note-text">
            {{note.text}}
          </p>
          <p class="metadata">
            [ {{note.meta.date.day}}/{{note.meta.date.month}}/{{note.meta.date.year}} | {{note.meta.time.hour}}:{{note.meta.time.min}} ]
          </p>
        </li>

        <!-- empty notebook text -->
        <div class="empty-notes" *ngIf="filteredNotes.length === 0 || allNotes.length === 0">
          <span class="query">
            <p>{{this.emptyNotebookText()}}</p>
          </span>
        </div>

      </ul>

      <!-- notebook buttons -->
      <div class="notebook-buttons {{notebookOptions ? 'active' : ''}} {{allNotes.length > 2 ? 'search-enabled' : ''}}">

        <!-- note counter -->
        <div class="notes-remaining">
          <p>Notes:</p>
          <div class="counter">
            <p>{{allNotes.length}} / 50</p>
          </div>
        </div>

        <!-- mobile hide/show options button -->
        <button class="notebook-toggle" (click)="toggleNotebookOptions()">
          {{notebookOptions ? 'Hide' : 'Show'}} options
          <i class="{{notebookOptions ? 'fa fa-chevron-down' : 'fa fa-chevron-up'}}" aria-hidden="true"></i>
        </button>

        <!-- export and delete all buttons -->
        <div class="buttons {{notebookOptions ? 'active' : ''}}">
          <button (click)="exportNotes()" class="export" [disabled]="filteredNotes.length <= 1">Export to file</button>
          <button (click)="deleteAll()" class="deleteAll" [disabled]="disableButton('delete-all')">Delete all notes</button>
        </div>
      </div>

    </div>
    
  </main>

  <!-- footer section -->
  <footer class="{{view !== 'info' ? 'disabled' : ''}}">
    <p>
      Note Taken is a notes app that stores all inputted data locally without sending anything to a database. Unless deleted, your notes remain secure in the browser on your device until you clear the cache. You can save up to 50 text notes of 140 characters each in various colours. They can be sorted by their time stamps, filtered by their colours, searched by an inputted query, edited, and deleted, as well as exported to a .txt file for offline access.
    </p>
    <p>
      <span class="credit">
        The site was built by <a href="https://danateagle.com">Dana Teagle</a> using Angular, Typescript, SCSS, and <a href="https://www.npmjs.com/package/file-saver">FileSaver.js</a>. See the source code <a href="https://github.com/torontopubliclibra/note-taken">here</a>.
      </span>
    </p>
  </footer>

</div>

<router-outlet></router-outlet>