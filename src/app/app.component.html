<div class="app">

  <!-- header section -->
  <header>
    <h1>Note Taken</h1>
    <h2>Your friendly little local storage notes app</h2>
  </header>

  <!-- mobile nav -->
  <nav>
    <button *ngIf="allNotes.length === 0 && mobileView !== 'info'" class="mobile-nav-link" disabled>
      <p>Notes (0)</p>
    </button>
    <button  *ngIf="allNotes.length > 0 && mobileView === 'notepad'" class="mobile-nav-link" (click)="toggleMobileView('notebook')" title="View your notes">
      <p>Notes ({{allNotes.length}})</p>
    </button>
    <button  *ngIf="allNotes.length > 0 && mobileView === 'notebook'" class="mobile-nav-link" (click)="toggleMobileView('notepad')" title="Add a new note">
      <p>Add note</p>
    </button>
    <button *ngIf="mobileView !== 'info'" class="mobile-nav-link info" (click)="toggleMobileView('info')" title="Info about the application">
      <p>About</p>
    </button>
    <button *ngIf="mobileView === 'info'" class="mobile-nav-link" (click)="toggleMobileView('notepad')" title="Go back to the application">
      <p>Back to app</p>
    </button>
  </nav>

  <!-- main section -->
  <main>

    <!-- notepad section -->
    <div class="notepad" class="{{noteColor}} {{mobileView === 'notebook' || mobileView === 'info' ? 'disabled' : ''}}">

      <!-- notepad colour options -->
      <div class="notepad-options">
        <p>Note colour:</p>
        <select [(ngModel)]="noteColor" title="Select your note colour">
          <option value="green">green</option>
          <option value="blue">blue</option>
          <option value="red">red</option>
          <option value="pink">pink</option>
          <option value="yellow">yellow</option>
          <option value="orange">orange</option>
        </select>
      </div>

      <!-- notepad text area -->
      <textarea [(ngModel)]="inputtedText" maxlength="100" wrap="hard" placeholder={{placeholder}} (keydown.enter)="saveNote($event)"></textarea>

      <!-- notepad save and clear buttons -->
      <div class="notepad-buttons">
        <button *ngIf="inputtedText" (click)="saveNote($event)" title="Save your note to storage">Save note</button>
        <button *ngIf="!inputtedText" disabled>Save note</button>

        <button *ngIf="inputtedText" (click)="clearText()" title="Clear the textbox">Clear text</button>
        <button *ngIf="!inputtedText" disabled>Clear text</button>
      </div>

    </div>

    <!-- notebook section -->
    <div class="notebook {{mobileView === 'notepad' || mobileView === 'info' ? 'disabled' : ''}}">

      <!-- notebook sort and filter options -->
      <div class="notebook-options">

        <div class="timeSort">
          <p>Sort order:</p>
          <select [(ngModel)]="timeSort" disabled="{{filteredNotes.length <= 1 ? true : false}}" title="Select the sort order">
            <option value="newest">newest first</option>
            <option value="oldest">oldest first</option>
          </select>
        </div>

        <div class="colorFilter">
          <p>Filter by colour:</p>
          <select [(ngModel)]="colorFilter" (ngModelChange)="filterNotesByColor()" disabled="{{noteColors.length <= 1 ? 'true' : 'false'}}" title="Select the colour filter">
            <option value="all">all</option>
            <option *ngFor="let color of noteColors; index as i" value={{color}}>{{color}}</option>
          </select>
        </div>

      </div>
      <div class="notebook-search {{allNotes.length < 3 ? 'disabled' : ''}}">

        <i class="fa fa-search" aria-hidden="true"></i>
        <input type="text" [(ngModel)]="searchQuery" (ngModelChange)="searchNotes()" placeholder="Search your notes" class="{{searchQuery ? 'active' : ''}}"/>

        <button *ngIf="!searchQuery" class="clear-search" disabled>
          Clear
        </button>
        <button *ngIf="searchQuery" (click)="clearSearch()" class="clear-search">
          Clear
        </button>

      </div>

      <!-- notebook list in descending order -->
      <ul *ngIf="timeSort === 'newest'" class="notes-list">
        <li *ngFor="let note of filteredNotes.slice().reverse(); index as i" class="{{note.color}} {{mobileView === 'notebook' ? 'active' : ''}}">
          <button class="edit" (click)="editNote(i)" title="Edit note">
            <i class="fa fa-pencil" aria-hidden="true"></i>
          </button>
          <button class="delete" (click)="deleteNote(i)" title="Delete note">
            <i class="fa fa-times" aria-hidden="true"></i>
          </button>
          <p class="note-text">
            {{note.text}}
          </p>
          <p class="metadata">
            {{note.meta.date}} @ {{note.meta.time}}
          </p>
        </li>
        <div class="no-search" *ngIf="searchQuery && filteredNotes.length === 0">
          <p>Sorry, but there aren't any notes matching that query</p>
          <p>Wanna try something else?</p>
        </div>
      </ul>

      <!-- notebook list in ascending order -->
      <ul *ngIf="timeSort === 'oldest'" class="notes-list">
        <li *ngFor="let note of filteredNotes.slice(); index as i" class="{{note.color}}">
          <button class="edit" (click)="editNote(i)" title="Edit note">
            <i class="fa fa-pencil" aria-hidden="true"></i>
          </button>
          <button class="delete" (click)="deleteNote(i)" title="Delete note">
            <i class="fa fa-times" aria-hidden="true"></i>
          </button>
          <p>{{note.text}}</p>
          <p class="metadata">
            {{note.meta.date}} @ {{note.meta.time}}
          </p>
        </li>
      </ul>

      <!-- notebook delete all button and note counter -->
      <div class="notebook-buttons">

        <div class="notes-remaining">
          <p>Notes:</p>
          <div class="counter">
            <p>{{allNotes.length}} / 20</p>
          </div>
        </div>

        <button *ngIf="filteredNotes.length > 1" (click)="exportNotes()" class="export" title="Export your notes to a text file">Export notes</button>
        <button *ngIf="filteredNotes.length <= 1" class="export" disabled>Export notes</button>

        <button *ngIf="filteredNotes.length > 0 && colorFilter === 'all' && !searchQuery" (click)="deleteAll()" class="deleteAll" title="Delete all of your notes">Delete all notes</button>
        <button *ngIf="filteredNotes.length <= 0 || colorFilter !== 'all' || searchQuery" class="deleteAll" disabled>Delete all notes</button>
      </div>

    </div>
    
  </main>

  <!-- footer section -->
  <footer class="{{mobileView !== 'info' ? 'disabled' : ''}}">
    <p>
      Note Taken is a notes app that stores all inputted data client-side without sending it to a database. Unless deleted, your notes remain in the browser on your device until you clear the cache. You can save up to 20 notes, each up to 100 characters in length.
    </p>
    <p>
      The site was built by <a href="https://danateagle.com">Dana Teagle</a>, written in Typescript and SCSS using Angular. See the source code <a href="https://github.com/torontopubliclibra/note-taken">here</a>.
    </p>
  </footer>

</div>

<router-outlet></router-outlet>